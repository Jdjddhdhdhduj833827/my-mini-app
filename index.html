<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="color-scheme" content="dark" />
  <meta name="theme-color" content="#0b0c10" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="format-detection" content="telephone=no" />

  <title>CRAFT ANALYTICS</title>
  <meta name="description" content="CRAFT ANALYTICS ‚Äî premium trading assistant (Telegram Mini App)" />

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <!-- Background (must not block clicks; in CSS: pointer-events:none) -->
  <div class="bg" aria-hidden="true">
    <div class="bgAura"></div>
    <div class="bgGrid"></div>
    <div class="bgNoise"></div>
  </div>

  <!-- =========================
       ACCESS / ONBOARDING GATE
  ========================== -->
  <section class="gate" id="gate">
    <div class="gateCard">
      <header class="gateHeader">
        <div class="brand">
          <div class="brandMark" aria-hidden="true">
            <span class="brandMarkInner">CA</span>
            <span class="brandMarkShine" aria-hidden="true"></span>
          </div>
          <div class="brandText">
            <div class="brandName">CRAFT ANALYTICS</div>
            <div class="brandSub">Premium terminal ‚Ä¢ Smart trading assistant</div>
          </div>
        </div>

        <div class="statusPills" aria-label="Status">
          <span class="pill" id="pillConn">‚óè online</span>
          <span class="pill pillGold hidden" id="pillVip">VIP</span>
          <button class="iconBtn hidden" id="btnOpenAdmin" type="button" aria-label="Admin console">
            Admin
          </button>
        </div>
      </header>

      <div class="gateHero">
        <h1 class="gateTitle" id="gateTitle">–î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É</h1>
        <p class="gateText" id="gateText">
          –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ. –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø ‚Äî
          <b>–≤—Ö–æ–¥ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ—Å–ª–µ –º–æ–µ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è</b>. –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞ ‚Äî
          –¥–æ—Å—Ç—É–ø –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
        </p>

        <div class="gateSteps" aria-label="Steps">
          <div class="step">
            <div class="stepNum">1</div>
            <div class="stepBody">
              <div class="stepTitle">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
              <div class="stepDesc">–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</div>
            </div>
          </div>
          <div class="step">
            <div class="stepNum">2</div>
            <div class="stepBody">
              <div class="stepTitle">–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞</div>
              <div class="stepDesc">–ù–∞–∂–∞—Ç—å ¬´–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø¬ª ‚Äî –∑–∞—è–≤–∫–∞ —É–π–¥—ë—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</div>
            </div>
          </div>
          <div class="step">
            <div class="stepNum">3</div>
            <div class="stepBody">
              <div class="stepTitle">–ê–≤—Ç–æ-–∞–∫—Ç–∏–≤–∞—Ü–∏—è</div>
              <div class="stepDesc">–ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–º –¥–µ–ø–æ–∑–∏—Ç–µ –¥–æ—Å—Ç—É–ø –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="gateActions">
        <button class="btn btnPrimary" id="btnOpenReg" type="button">
          <span class="btnIcon">‚Üó</span>
          <span>–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</span>
          <span class="btnGlow" aria-hidden="true"></span>
        </button>

        <button class="btn btnGlass" id="btnRequestAccess" type="button">
          <span class="btnIcon">‚ü°</span>
          <span>–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø</span>
        </button>

        <button class="btn btnGlass" id="btnEnter" type="button" disabled>
          <span class="btnIcon">‚ü∂</span>
          <span>–í–æ–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</span>
        </button>

        <div class="gateHint" id="gateHint">
          –°—Ç–∞—Ç—É—Å: <b id="accessStatus">–Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</b>
        </div>

        <div class="legal">
          –î–µ–º–æ-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ù–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ —Å–≤–æ–π —Ä–∏—Å–∫.
        </div>
      </div>

      <footer class="gateFooter">
        <div class="meter" aria-label="Access meter">
          <div class="meterFill" id="meterFill" style="width:10%"></div>
        </div>
        <div class="meterText" id="meterText">SECURITY ‚Ä¢ initData required</div>
      </footer>
    </div>
  </section>

  <!-- =========================
            MAIN APP
  ========================== -->
  <div class="app hidden" id="app">
    <!-- TOP BAR -->
    <header class="topbar">
      <div class="topLeft">
        <div class="brandMini">
          <div class="brandMark sm" aria-hidden="true">
            <span class="brandMarkInner">CA</span>
            <span class="brandMarkShine" aria-hidden="true"></span>
          </div>
          <div class="brandText">
            <div class="brandName sm">CRAFT ANALYTICS</div>
            <div class="brandSub sm" id="subTitle">Smart trading assistant</div>
          </div>
        </div>
      </div>

      <div class="topRight">
        <span class="pill hidden" id="pillRole">FREE</span>
        <span class="pill pillGold hidden" id="pillVipTop">VIP</span>

        <button class="iconBtn" id="btnLang" type="button" aria-label="Language">üåê</button>
        <button class="iconBtn" id="btnMenu" type="button" aria-label="Menu">‚ãØ</button>
      </div>
    </header>

    <main class="content">

      <!-- DASH / STATUS -->
      <section class="panel">
        <div class="panelHead">
          <div class="panelTitle">DASHBOARD</div>
          <div class="panelRight">
            <span class="chip" id="chipPing">PING: OK</span>
            <span class="chip" id="chipMode">MODE: SMART</span>
            <span class="chip chipGold hidden" id="chipVip">VIP ACTIVE</span>
          </div>
        </div>

        <div class="statusRow">
          <div class="statusCard">
            <div class="k">–°–µ—Å—Å–∏—è</div>
            <div class="v" id="vSession">‚Äî</div>
          </div>
          <div class="statusCard">
            <div class="k">–ü—Ä–æ—Ñ–∏–ª—å</div>
            <div class="v" id="vProfile">‚Äî</div>
          </div>
          <div class="statusCard">
            <div class="k">–î–æ—Å—Ç—É–ø</div>
            <div class="v" id="vAccess">‚Äî</div>
          </div>
        </div>
      </section>

      <!-- CONTROLS -->
      <section class="panel">
        <div class="panelHead">
          <div class="panelTitle">CONTROL CENTER</div>
          <div class="panelRight">
            <button class="chipBtn" id="btnPresetSave" type="button">‚òÖ preset</button>
            <button class="chipBtn" id="btnHistory" type="button">‚ßâ history</button>
          </div>
        </div>

        <div class="row">
          <button class="select" id="assetBtn" type="button" aria-label="Select asset">
            <div class="selectLeft">
              <span class="badge" id="assetBadge" aria-hidden="true">üí±</span>
              <span class="selectValue" id="assetValue">EUR/USD</span>
            </div>
            <span class="chev" aria-hidden="true">‚ñæ</span>
          </button>

          <button class="select compact" id="tfBtn" type="button" aria-label="Select timeframe">
            <div class="selectLeft">
              <span class="badge" aria-hidden="true">‚è±</span>
              <span class="selectValue" id="tfValue">30s</span>
            </div>
            <span class="chev" aria-hidden="true">‚ñæ</span>
          </button>

          <button class="select compact" id="marketBtn" type="button" aria-label="Toggle market">
            <div class="selectLeft">
              <span class="badge" aria-hidden="true">üåê</span>
              <span class="selectValue" id="marketValue">OTC</span>
            </div>
            <span class="chev" aria-hidden="true">‚Ü∫</span>
          </button>
        </div>

        <div class="hint" id="hintText">
          –ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑¬ª ‚Äî –ø–æ–ª—É—á–∏—Ç–µ —Å–∏–≥–Ω–∞–ª –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.
        </div>

        <div class="actions">
          <button class="btn btnPrimary btnWide" id="btnAnalyze" type="button">
            <span class="btnIcon">‚ü°</span>
            <span id="analyzeText">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑</span>
            <span class="btnGlow" aria-hidden="true"></span>
          </button>

          <button class="btn btnGlass" id="btnReset" type="button">
            <span class="btnIcon">‚ü≤</span>
            <span id="resetText">–°–±—Ä–æ—Å</span>
          </button>
        </div>
      </section>

      <!-- VISUAL + SIGNAL -->
      <section class="panel">
        <div class="panelHead">
          <div class="panelTitle">SIGNAL PANEL</div>
          <div class="panelRight">
            <span class="chip" id="chipQuality">Quality: ‚Äî</span>
            <span class="chip" id="chipConf">Conf: ‚Äî</span>
          </div>
        </div>

        <!-- Main chart area (visual) -->
        <div class="chartWrap" id="chartWrap">
          <canvas id="chart" width="920" height="420" aria-label="Chart"></canvas>
          <div class="chartOverlay hidden" id="chartOverlay" aria-hidden="true">
            <div class="overlayTitle">SCANNING</div>
            <div class="overlayLine" id="overlayLine">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä—ã–Ω–∫–∞‚Ä¶</div>
            <div class="overlayBar"><div class="overlayFill" id="overlayFill"></div></div>
          </div>
        </div>

        <!-- Result block -->
        <div class="signalCard" id="signalCard">
          <div class="signalLeft">
            <div class="label">–°–ò–ì–ù–ê–õ</div>

            <!-- IMPORTANT: up/down changed to "–ø–æ–≤—ã—à–µ–Ω–∏–µ/–ø–æ–Ω–∏–∂–µ–Ω–∏–µ" + arrow + colors -->
            <div class="signalLine">
              <span class="dirArrow up" id="dirArrow" aria-hidden="true">‚ñ≤</span>
              <span class="dirText up" id="dirText">–ø–æ–≤—ã—à–µ–Ω–∏–µ</span>

              <span class="signalMeta">
                <span class="metaDot" aria-hidden="true"></span>
                <span>–æ–∫–Ω–æ:</span> <b id="rWindow">‚Äî</b>
                <span class="metaSep">‚Ä¢</span>
                <span>–¥–æ</span> <b id="rUntil">--:--</b>
              </span>

              <span class="vipBadge hidden" id="vipBadge" aria-label="VIP">VIP</span>
            </div>

            <div class="miniMetrics">
              <div class="m">
                <div class="k">–¢–æ—á–Ω–æ—Å—Ç—å</div>
                <div class="v" id="rAcc">‚Äî%</div>
              </div>
              <div class="m">
                <div class="k">–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å</div>
                <div class="v" id="volFactor">‚Äî</div>
              </div>
              <div class="m">
                <div class="k">–ò–º–ø—É–ª—å—Å</div>
                <div class="v" id="momFactor">‚Äî</div>
              </div>
              <div class="m">
                <div class="k">–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å</div>
                <div class="v" id="liqFactor">‚Äî</div>
              </div>
            </div>
          </div>

          <!-- Mini chart for signal confirmation -->
          <div class="signalRight">
            <div class="label">–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï</div>
            <div class="miniChart">
              <canvas id="signalChart" width="520" height="220" aria-label="Signal mini chart"></canvas>
              <div class="miniChartHint" id="miniChartHint">–ú–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫ ‚Ä¢ –¥–µ–º–æ-—Ä–µ–Ω–¥–µ—Ä (–ø–æ–∑–∂–µ –ø–æ–¥–∫–ª—é—á–∏–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)</div>
            </div>
          </div>
        </div>

        <div class="footnote">
          –î–µ–º–æ-–ª–æ–≥–∏–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤. –†–µ–∞–ª—å–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞/VIP –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä + –ø—Ä–æ–≤–µ—Ä–∫—É Telegram initData.
        </div>
      </section>
    </main>
  </div>

  <!-- =========================
            MODALS
  ========================== -->
  <div class="backdrop hidden" id="backdrop" aria-hidden="true"></div>

  <!-- Assets -->
  <section class="modal hidden" id="assetsModal" role="dialog" aria-modal="true" aria-label="Assets modal">
    <div class="modalTop">
      <div class="modalTitle" id="assetsTitle">–í—ã–±–æ—Ä –∞–∫—Ç–∏–≤–∞</div>
      <button class="iconBtn" id="closeAssets" aria-label="Close" type="button">‚úï</button>
    </div>
    <input class="search" id="assetSearch" placeholder="–ü–æ–∏—Å–∫‚Ä¶" autocomplete="off" />
    <div class="tabs" id="assetTabs" aria-label="Categories"></div>
    <div class="list" id="assetList" aria-label="Assets list"></div>
  </section>

  <!-- Timeframes -->
  <section class="modal hidden" id="tfModal" role="dialog" aria-modal="true" aria-label="Timeframe modal">
    <div class="modalTop">
      <div class="modalTitle" id="tfTitle">–í—ã–±–æ—Ä —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞</div>
      <button class="iconBtn" id="closeTf" aria-label="Close" type="button">‚úï</button>
    </div>
    <div class="list" id="tfList" aria-label="Timeframes list"></div>
  </section>

  <!-- Language -->
  <section class="modal hidden" id="langModal" role="dialog" aria-modal="true" aria-label="Language modal">
    <div class="modalTop">
      <div class="modalTitle" id="langTitle">–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</div>
      <button class="iconBtn" id="closeLang" aria-label="Close" type="button">‚úï</button>
    </div>
    <div class="list" id="langList" aria-label="Languages list"></div>
  </section>

  <!-- Admin console (UI only; requires backend) -->
  <section class="modal hidden" id="adminModal" role="dialog" aria-modal="true" aria-label="Admin console">
    <div class="modalTop">
      <div class="modalTitle">ADMIN CONSOLE</div>
      <button class="iconBtn" id="closeAdmin" aria-label="Close" type="button">‚úï</button>
    </div>

    <div class="adminBody">
      <div class="adminGrid">
        <div class="adminCard">
          <div class="k">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
          <div class="v" id="admUsers">‚Äî</div>
        </div>
        <div class="adminCard">
          <div class="k">–û–∂–∏–¥–∞—é—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è</div>
          <div class="v" id="admPending">‚Äî</div>
        </div>
        <div class="adminCard">
          <div class="k">VIP –∞–∫—Ç–∏–≤–Ω—ã</div>
          <div class="v" id="admVip">‚Äî</div>
        </div>
      </div>

      <div class="adminActions">
        <button class="btn btnGlass" id="btnAdmRefresh" type="button">‚ü≤ –û–±–Ω–æ–≤–∏—Ç—å</button>
        <button class="btn btnGlass" id="btnAdmToggleUser" type="button">‚õî –í–∫–ª/–í—ã–∫–ª –¥–æ—Å—Ç—É–ø</button>
        <button class="btn btnGlass" id="btnAdmApprove" type="button">‚úì –û–¥–æ–±—Ä–∏—Ç—å</button>
        <button class="btn btnGlass" id="btnAdmVip" type="button">‚ú¶ –í—ã–¥–∞—Ç—å VIP</button>
      </div>

      <div class="adminList">
        <div class="label">–°–ø–∏—Å–æ–∫ (–¥–µ–º–æ)</div>
        <div class="list" id="adminUserList" aria-label="Admin user list"></div>
      </div>

      <div class="footnote">
        –≠—Ç–∞ –ø–∞–Ω–µ–ª—å —Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—á–µ–π –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è backend (Cloudflare Worker/D1) –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ Telegram initData.
      </div>
    </div>
  </section>

  <!-- App JS -->
  <script src="./app.js" defer></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  async function checkAccess() {
    const initData = tg.initData;

    const response = await fetch(
      "https://hidden-fog-c1f2craft-analytics-api.ashirkhanlogubekov-833.workers.dev/pb/auth",
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ initData })
      }
    );

    const data = await response.json();

    console.log("AUTH RESPONSE:", data);

   if (!data.ok) return;
if (!data.access) return;

if (data.vip) {
  document.getElementById("accessTitle").textContent = "VIP –∞–∫—Ç–∏–≤–µ–Ω üëë";
  document.getElementById("accessText").textContent = "–î–æ—Å—Ç—É–ø –æ—Ç–∫—Ä—ã—Ç";
  document.getElementById("accessStatus").style.display = "block";
} else {
  document.getElementById("accessTitle").textContent = "–î–æ—Å—Ç—É–ø –æ—Ç–∫—Ä—ã—Ç ‚úÖ";
  document.getElementById("accessText").textContent = "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å";
  document.getElementById("accessStatus").style.display = "block";
}
  }

  checkAccess();
</script>
<div id="accessStatus" style="display:none; padding:14px; border-radius:12px; margin:14px; background:rgba(255,255,255,0.08); color:#fff;">
  <b id="accessTitle">–°—Ç–∞—Ç—É—Å</b>
  <div id="accessText" style="margin-top:6px; opacity:.9;"></div>
</div>
  <!-- ACCESS OVERLAY (–≤–∏–¥–Ω–æ –≤—Å—ë, –Ω–æ –∫–ª–∏–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã) -->
<div id="gateOverlay" style="
  position:fixed; inset:0; z-index:99999;
  display:none; align-items:center; justify-content:center;
  background:rgba(0,0,0,.45);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
">
  <div style="
    max-width:520px; width:90%;
    padding:18px 16px; border-radius:16px;
    background:rgba(20,20,24,.72); color:#fff;
    border:1px solid rgba(255,255,255,.10);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  ">
    <div style="font-size:18px; font-weight:700; margin-bottom:6px;">
      –î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω
    </div>
    <div id="gateText" style="opacity:.9; line-height:1.35;">
      –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É...
    </div>
  </div>
</div>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
  const API_BASE = "https://hidden-fog-c1f2craft-analytics-api.ashirkhanlogubekov-833.workers.dev";

  function gate(show, text) {
    const o = document.getElementById("gateOverlay");
    const t = document.getElementById("gateText");
    if (!o || !t) return;
    if (show) {
      t.textContent = text || "–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω.";
      o.style.display = "flex";
      // –±–ª–æ–∫–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –ø–æ–¥ overlay
      document.documentElement.style.pointerEvents = "none";
      o.style.pointerEvents = "auto";
    } else {
      o.style.display = "none";
      document.documentElement.style.pointerEvents = "auto";
    }
  }

  async function checkAccessAndGate() {
    // –ù–∏—á–µ–≥–æ –Ω–µ –ª–æ–º–∞–µ–º: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∏–¥–µ–Ω –≤—Å–µ–≥–¥–∞.
    // –ü—Ä–æ—Å—Ç–æ —Å—Ç–∞–≤–∏–º "–∑–∞–º–æ–∫" –ø–æ–≤–µ—Ä—Ö, –µ—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞.
    gate(true, "–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø...");

    const tg = window.Telegram?.WebApp;
    if (tg) tg.expand();

    const initData = tg?.initData || "";
    if (!initData) {
      // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª –Ω–µ –∏–∑ Telegram ‚Äî –ª—É—á—à–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å, –∏–Ω–∞—á–µ –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±–æ–π—Ç–∏ –º–æ–∂–Ω–æ.
      gate(true, "–û—Ç–∫—Ä–æ–π—Ç–µ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ Telegram.");
      return;
    }

    let data = null;
    try {
      const resp = await fetch(API_BASE + "/pb/auth", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ initData })
      });
      data = await resp.json();
    } catch (e) {
      gate(true, "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
      return;
    }

    // –í–ê–ñ–ù–û: –µ—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ ‚Äî UI –≤–∏–¥–Ω–æ, –Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (overlay –æ—Å—Ç–∞–µ—Ç—Å—è)
    if (!data?.ok) {
      gate(true, "–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
      return;
    }

    if (!data.access) {
      // –ù–∏–∫–∞–∫–∏—Ö ‚Äú–≤—ã–ª–µ–∑–∞—é—â–∏—Ö‚Äù —Å–æ–æ–±—â–µ–Ω–∏–π.
      // –ü—Ä–æ—Å—Ç–æ ‚Äú–∑–∞–º–æ–∫‚Äù —Å–≤–µ—Ä—Ö—É (–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω/–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∏–¥–µ–Ω).
      gate(true, "–°–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏ –ø–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ ¬´–Ø –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è¬ª –≤ –±–æ—Ç–µ.");
      return;
    }

    // –¥–æ—Å—Ç—É–ø –µ—Å—Ç—å
    gate(false);
  }

  window.addEventListener("DOMContentLoaded", checkAccessAndGate);
</script>
</body>
</html>
